<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>February Hydrogen Safety Connections</title>
<style>
  :root{
    --chs-blue:#005e82;
    --bg:#f5f5f5;
    --card:#ffffff;
    --border:#dddddd;
    --yellow:#f6e58d;
    --green:#badc58;
    --blue:#7ed6df;
    --purple:#c7a7ff;
  }
  body{ font-family: Arial, sans-serif; background:var(--bg); margin:0; padding:20px; color:#222; }
  .wrap{ max-width: 820px; margin: 0 auto; text-align:center; }
  .card{
    background:var(--card); border:1px solid var(--border); border-radius:10px;
    padding:16px; text-align:left;
  }
  h1{ margin:0 0 6px 0; color:var(--chs-blue); font-size:22px; }
  .sub{ margin:0; color:#555; font-size:14px; line-height:1.35; }
  .meta{ display:flex; gap:12px; flex-wrap:wrap; margin-top:10px; }
  .pill{ font-size:12px; color:#444; background:#fafafa; border:1px solid var(--border); border-radius:999px; padding:6px 10px; }
  .controls{ margin:14px 0 6px; text-align:center; }
  button{
    padding:10px 14px; border:none; border-radius:6px; cursor:pointer;
    background:var(--chs-blue); color:#fff; font-size:14px; margin:6px 6px 0;
  }
  button.secondary{ background:#666; }
  button:disabled{ background:#ccc; cursor:default; }
  .grid{
    display:grid; grid-template-columns: repeat(4, 1fr);
    gap:12px; margin-top:14px;
  }
  .tile{
    background:var(--card); border:2px solid var(--border); border-radius:8px;
    padding:14px 10px; min-height:64px; cursor:pointer; user-select:none;
    display:flex; align-items:center; justify-content:center; text-align:center;
    transition: background-color .15s, border-color .15s, transform .05s;
    font-size:14px;
  }
  .tile:hover{ transform: translateY(-1px); }
  .tile.selected{ background:#bfe2f0; border-color:var(--chs-blue); }
  .tile.solved{ cursor:default; font-weight:bold; border-color: rgba(0,0,0,.15); }
  .solved.yellow{ background:var(--yellow); }
  .solved.green{ background:var(--green); }
  .solved.blue{ background:var(--blue); }
  .solved.purple{ background:var(--purple); }

  #message{ margin-top:12px; min-height:22px; text-align:center; font-size:14px; }
  .answers{
    display:none; margin-top:16px; text-align:left;
    background:var(--card); border:1px solid var(--border); border-radius:10px; padding:14px 16px;
  }
  .answers h3{ margin:0 0 10px 0; color:var(--chs-blue); font-size:16px; }
  .group{ margin:10px 0; font-size:14px; line-height:1.35; }
  .foot{ margin-top:14px; text-align:center; font-size:12px; color:#666; }
  .error{
    display:none; margin-top:12px; padding:10px 12px; border-radius:8px;
    background:#fff0f0; border:1px solid #ffcccc; color:#8a0000; text-align:left; font-size:13px;
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- This header always shows even if JS fails -->
  <div class="card">
    <h1>February Hydrogen Safety Connections</h1>
    <p class="sub">Select 4 related terms to form a category. Shuffle anytime. ‚ÄúOne away‚Äù hints appear when 3 of 4 match a real group.</p>
    <div class="meta">
      <div class="pill">‚è± Time: <strong id="timer">00:00</strong></div>
      <div class="pill">‚úÖ Groups solved: <strong id="solvedCount">0</strong>/4</div>
    </div>

    <div class="controls">
      <button id="submitBtn" disabled>Submit Selection</button>
      <button id="shuffleBtn" class="secondary">Shuffle Tiles</button>
      <button id="revealBtn" class="secondary">Reveal Answers</button>
    </div>

    <div id="grid" class="grid" aria-label="Puzzle tiles"></div>
    <div id="message"></div>
    <div id="errorBox" class="error"></div>

    <div id="answers" class="answers">
      <h3>Solution</h3>
      <div class="group"><strong>üü® Codes & Standards</strong><br>NFPA 2 ‚Ä¢ ISO 19880 ‚Ä¢ CGA G-5.5 ‚Ä¢ ASME B31.12</div>
      <div class="group"><strong>üü© Fueling Station Components</strong><br>Dispenser ‚Ä¢ Breakaway Coupling ‚Ä¢ Nozzle ‚Ä¢ Cascade Storage</div>
      <div class="group"><strong>üü¶ Emergency Response Concepts</strong><br>Isolation Distance ‚Ä¢ Gas Monitoring ‚Ä¢ Evacuation Plan ‚Ä¢ Incident Command</div>
      <div class="group"><strong>üü™ Hydrogen Physical Properties</strong><br>Wide Flammability Range ‚Ä¢ Low Ignition Energy ‚Ä¢ High Diffusivity ‚Ä¢ Buoyant Gas</div>
    </div>

    <div class="foot">Tip: Use this as a quick training icebreaker.</div>
  </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  try {
    const TERMS = [
      "NFPA 2","ISO 19880","CGA G-5.5","ASME B31.12",
      "Dispenser","Breakaway Coupling","Nozzle","Cascade Storage",
      "Isolation Distance","Gas Monitoring","Evacuation Plan","Incident Command",
      "Wide Flammability Range","Low Ignition Energy","High Diffusivity","Buoyant Gas"
    ];

    const GROUP_TEMPLATES = [
      { name:"Codes & Standards", items:["NFPA 2","ISO 19880","CGA G-5.5","ASME B31.12"] },
      { name:"Fueling Station Components", items:["Dispenser","Breakaway Coupling","Nozzle","Cascade Storage"] },
      { name:"Emergency Response Concepts", items:["Isolation Distance","Gas Monitoring","Evacuation Plan","Incident Command"] },
      { name:"Hydrogen Physical Properties", items:["Wide Flammability Range","Low Ignition Energy","High Diffusivity","Buoyant Gas"] }
    ];

    const COLORS = ["yellow","green","blue","purple"];

    const grid = document.getElementById("grid");
    const submitBtn = document.getElementById("submitBtn");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const revealBtn = document.getElementById("revealBtn");
    const message = document.getElementById("message");
    const timerEl = document.getElementById("timer");
    const solvedCountEl = document.getElementById("solvedCount");
    const answers = document.getElementById("answers");
    const errorBox = document.getElementById("errorBox");

    let groups = GROUP_TEMPLATES.map(g => ({ name: g.name, items: g.items.slice() }));
    let selected = [];
    let solvedMap = new Map(); // term -> color
    let solvedCount = 0;

    // Timer
    let startTime = null;
    let timerInterval = null;

    function pad2(n){ return String(n).padStart(2,"0"); }
    function startTimer(){
      if (startTime) return;
      startTime = Date.now();
      timerInterval = setInterval(() => {
        const diff = Math.floor((Date.now() - startTime)/1000);
        timerEl.textContent = `${pad2(Math.floor(diff/60))}:${pad2(diff%60)}`;
      }, 300);
    }
    function stopTimer(){
      if (!timerInterval) return;
      clearInterval(timerInterval);
      timerInterval = null;
    }

    function shuffle(arr){
      const a = arr.slice();
      for (let i=a.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    function clearSelectionsUI(){
      document.querySelectorAll(".tile.selected").forEach(el => el.classList.remove("selected"));
      selected = [];
      submitBtn.disabled = true;
    }

    function render(){
      grid.innerHTML = "";
      const shuffled = shuffle(TERMS);

      shuffled.forEach(term => {
        const t = document.createElement("div");
        t.className = "tile";
        t.textContent = term;

        if (solvedMap.has(term)){
          t.classList.add("solved", solvedMap.get(term));
        }

        t.addEventListener("click", () => {
          if (t.classList.contains("solved")) return;
          startTimer();

          if (selected.includes(term)){
            selected = selected.filter(x => x !== term);
            t.classList.remove("selected");
          } else {
            if (selected.length >= 4) return;
            selected.push(term);
            t.classList.add("selected");
          }
          submitBtn.disabled = (selected.length !== 4);
          message.textContent = "";
        });

        grid.appendChild(t);
      });
    }

    function oneAwayHint(){
      for (const g of groups){
        const cnt = g.items.filter(x => selected.includes(x)).length;
        if (cnt === 3) return g.name;
      }
      return null;
    }

    function findExactMatchIndex(){
      return groups.findIndex(g => g.items.every(x => selected.includes(x)));
    }

    submitBtn.addEventListener("click", () => {
      const idx = findExactMatchIndex();

      if (idx !== -1){
        const g = groups[idx];
        const color = COLORS[solvedCount] || "green";
        g.items.forEach(term => solvedMap.set(term, color));
        solvedCount++;
        solvedCountEl.textContent = String(solvedCount);
        groups.splice(idx, 1);

        message.textContent = `‚úÖ Correct! Group found: ${g.name}`;
        clearSelectionsUI();
        render();

        if (solvedCount === 4){
          stopTimer();
          message.textContent = "üéâ All groups solved!";
          submitBtn.disabled = true;
        }
      } else {
        const hint = oneAwayHint();
        message.textContent = hint ? `üü® One away! You're close to: ${hint}` : "‚ùå Not a valid group ‚Äî try again!";
        clearSelectionsUI();
      }
    });

    shuffleBtn.addEventListener("click", () => {
      message.textContent = "";
      clearSelectionsUI();
      render();
    });

    revealBtn.addEventListener("click", () => {
      const ok = confirm("Reveal the answers? This will end the puzzle.");
      if (!ok) return;

      stopTimer();
      answers.style.display = "block";

      // Color-lock everything in template order
      solvedMap = new Map();
      GROUP_TEMPLATES.forEach((g, i) => {
        const color = COLORS[i] || "green";
        g.items.forEach(term => solvedMap.set(term, color));
      });
      solvedCount = 4;
      solvedCountEl.textContent = "4";
      message.textContent = "Answers revealed.";
      clearSelectionsUI();
      render();
    });

    // initial render
    render();

  } catch (err){
    const errorBox = document.getElementById("errorBox");
    errorBox.style.display = "block";
    errorBox.textContent = "This page hit a script error: " + (err && err.message ? err.message : String(err));
  }
});
</script>

</body>
</html>
